number: 38
title: Opt-in drift detection with operator ownership tracking
category: architecture
decision: Drift detection and auto-reconciliation is opt-in per resource. Only resources
  created/managed by THIS operator instance perform drift detection. Track ownership
  via annotations or status fields.
agent_instructions: Implement drift detection that compares CRD spec with actual Keycloak
  state. Only reconcile drift for resources the operator created (check ownership
  markers). Drift detection should be opt-in via CRD field or annotation. Never modify
  resources created by other operators or manual processes unless explicitly owned.
rationale: Opt-in prevents operator from interfering with manually managed resources
  or resources managed by other automation. Ownership tracking prevents conflicts
  in multi-operator scenarios. Drift detection provides self-healing for GitOps workflows
  where manual changes should be reverted. Ownership markers (annotations, status)
  clearly indicate which operator manages which resources. Users can disable drift
  detection for resources they want to manage semi-manually.
provenance: human
rejected_alternatives:
- alternative: Always-on drift detection for all resources
  reason: Would override manual changes users might intentionally make. Conflicts
    with troubleshooting workflows.
- alternative: No drift detection
  reason: GitOps workflows require drift detection to enforce declarative state. Manual
    changes would persist.
