number: 49
title: Horizontal scaling via multiple operator deployments (realm sharding)
category: architecture
decision: Horizontal scaling of operator capacity is achieved by deploying multiple
  operator instances, each managing a different subset of realms. This mimics classic
  sharding but at the operator deployment level. HA replicas (ADR 45) are for availability
  only, not capacity scaling.
agent_instructions: Horizontal scaling uses multiple operator deployments, each managing
  different realm subsets. Do not use HA replicas for capacity scaling.
rationale: When operator reaches reconciliation capacity limits, deploy additional
  operators rather than adding more replicas to a single deployment. Each operator
  manages a different set of realms - effectively sharding by realm. This is simpler
  than implementing proper work distribution/sharding within a single operator deployment,
  and achieves the same result. Users configure CRs to reference specific operators.
  Known limitation - all operators still monitor all CRs cluster-wide, but only reconcile
  CRs that reference them. If monitoring overhead becomes an issue (unlikely for
  99% of users - would require enormous clusters), there is no solution within this
  architecture. Keycloak API is almost certainly the bottleneck before operator capacity
  becomes an issue.
provenance: human
rejected_alternatives:
- alternative: Use HA replicas for capacity scaling
  reason: Active-standby HA (ADR 45) does not increase capacity - only one replica
    is active. Would require complex active-active work distribution.
- alternative: Implement proper sharding within single operator
  reason: Much more complex to implement. Would still shard by realm, resulting in
    essentially the same architecture but requiring more configuration in CRs.
- alternative: Namespace-scoped operators to reduce monitoring overhead
  reason: Loses ability to watch cross-namespace resources. Monitoring overhead is
    negligible compared to reconciliation work.
