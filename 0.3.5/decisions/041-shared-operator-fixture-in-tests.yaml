number: 41
title: Shared operator fixture in tests
category: development
decision: Use shared pytest fixture for operator deployment in integration tests.
  Single operator instance serves all integration tests to reduce setup time and resource
  usage.
agent_instructions: Define operator fixture at session scope in conftest.py. Deploy
  operator once per test session, not per test. Use namespace fixtures for test isolation.
  Tests should be independent despite sharing operator. Clean up test resources between
  tests, not operator itself.
rationale: 'Deploying operator for every test is slow. Session-scoped fixture deploys
  once, amortizing cost across all tests. Reduces Kind cluster resource usage - single
  operator deployment vs dozens. Faster test suite execution. Tests remain isolated
  via namespace-scoped fixtures for resources. Operator reconciles resources in all
  namespaces so single instance can serve multiple test namespaces. Trade-off: Tests
  can''t modify operator configuration, but that''s rarely needed.'
provenance: human
rejected_alternatives:
- alternative: Deploy operator per test
  reason: Very slow. Each test waits for operator deployment. Excessive resource usage
    in Kind cluster.
- alternative: No operator, mock reconciliation
  reason: Defeats purpose of integration tests. Need real operator behavior to catch
    bugs.
