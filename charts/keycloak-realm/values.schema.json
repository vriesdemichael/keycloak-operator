{
  "$schema": "https://json-schema.org/draft-07/schema#",
  "type": "object",
  "properties": {
    "realmName": {
      "type": "string",
      "description": "Name of the Keycloak realm"
    },
    "displayName": {
      "type": "string",
      "description": "Display name for the realm"
    },
    "operatorRef": {
      "type": "object",
      "properties": {
        "namespace": {
          "type": "string",
          "description": "Namespace where the operator is running"
        }
      },
      "required": ["namespace"]
    },
    "clientAuthorizationGrants": {
      "type": "array",
      "description": "List of namespaces authorized to create clients in this realm",
      "items": {
        "type": "string"
      }
    },
    "security": {
      "type": "object",
      "properties": {
        "registrationAllowed": {"type": "boolean"},
        "registrationEmailAsUsername": {"type": "boolean"},
        "editUsernameAllowed": {"type": "boolean"},
        "resetPasswordAllowed": {"type": "boolean"},
        "rememberMe": {"type": "boolean"},
        "verifyEmail": {"type": "boolean"},
        "loginWithEmailAllowed": {"type": "boolean"},
        "duplicateEmailsAllowed": {"type": "boolean"},
        "bruteForceProtected": {"type": "boolean"},
        "permanentLockout": {"type": "boolean"},
        "maxFailureWait": {"type": "integer"},
        "minimumQuickLoginWait": {"type": "integer"},
        "waitIncrement": {"type": "integer"},
        "quickLoginCheckMillis": {"type": "integer"},
        "maxDeltaTime": {"type": "integer"},
        "failureFactor": {"type": "integer"}
      }
    },
    "themes": {
      "type": "object",
      "properties": {
        "login": {"type": "string"},
        "admin": {"type": "string"},
        "account": {"type": "string"},
        "email": {"type": "string"}
      }
    },
    "localization": {
      "type": "object",
      "properties": {
        "defaultLocale": {"type": "string"},
        "supportedLocales": {
          "type": "array",
          "items": {"type": "string"}
        },
        "enabled": {"type": "boolean"}
      }
    },
    "tokenSettings": {
      "type": "object",
      "properties": {
        "accessTokenLifespan": {"type": "integer"},
        "accessTokenLifespanForImplicitFlow": {"type": "integer"},
        "ssoSessionIdleTimeout": {"type": "integer"},
        "ssoSessionMaxLifespan": {"type": "integer"},
        "offlineSessionIdleTimeout": {"type": "integer"},
        "offlineSessionMaxLifespanEnabled": {"type": "boolean"},
        "offlineSessionMaxLifespan": {"type": "integer"},
        "clientSessionIdleTimeout": {"type": "integer"},
        "clientSessionMaxLifespan": {"type": "integer"}
      }
    },
    "smtpServer": {
      "type": "object",
      "properties": {
        "enabled": {"type": "boolean"},
        "host": {"type": "string"},
        "port": {"type": "integer"},
        "from": {"type": "string"},
        "fromDisplayName": {"type": "string"},
        "replyTo": {"type": "string"},
        "envelopeFrom": {"type": "string"},
        "ssl": {"type": "boolean"},
        "starttls": {"type": "boolean"},
        "auth": {"type": "boolean"},
        "user": {"type": "string"},
        "passwordSecret": {
          "type": "object",
          "properties": {
            "name": {"type": "string"},
            "key": {"type": "string"}
          }
        }
      }
    },
    "attributes": {
      "type": "object",
      "additionalProperties": {"type": "string"}
    },
    "description": {
      "type": "string",
      "description": "Realm description"
    },
    "loginPageTitle": {
      "type": "string",
      "description": "HTML title for login pages"
    },
    "identityProviders": {
      "type": "array",
      "description": "External identity providers (OIDC, SAML, social logins)",
      "items": {
        "type": "object",
        "properties": {
          "alias": {
            "type": "string",
            "description": "Identity provider alias (unique identifier)"
          },
          "providerId": {
            "type": "string",
            "description": "Provider type (e.g., oidc, saml, github, google)"
          },
          "displayName": {
            "type": "string",
            "description": "Display name for the identity provider"
          },
          "enabled": {
            "type": "boolean",
            "description": "Whether the provider is enabled"
          },
          "trustEmail": {
            "type": "boolean",
            "description": "Trust email from identity provider"
          },
          "storeToken": {
            "type": "boolean",
            "description": "Store identity provider tokens"
          },
          "linkOnly": {
            "type": "boolean",
            "description": "Link existing users only"
          },
          "firstBrokerLoginFlowAlias": {
            "type": "string",
            "description": "First broker login flow alias"
          },
          "postBrokerLoginFlowAlias": {
            "type": "string",
            "description": "Post broker login flow alias"
          },
          "config": {
            "type": "object",
            "description": "Provider-specific configuration",
            "additionalProperties": true
          },
          "configSecrets": {
            "type": "object",
            "description": "Secret references for sensitive config values",
            "additionalProperties": {
              "type": "object",
              "properties": {
                "name": {
                  "type": "string",
                  "description": "Secret name"
                },
                "key": {
                  "type": "string",
                  "description": "Key in secret data"
                }
              },
              "required": ["name", "key"]
            }
          }
        },
        "required": ["alias", "providerId"]
      }
    },
    "clientScopes": {
      "type": "array",
      "description": "Client scope definitions",
      "items": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "description": "Scope name (unique identifier)"
          },
          "description": {
            "type": "string",
            "description": "Scope description"
          },
          "protocol": {
            "type": "string",
            "description": "Protocol (openid-connect or saml)",
            "enum": ["openid-connect", "saml"]
          },
          "attributes": {
            "type": "object",
            "description": "Scope attributes",
            "additionalProperties": {"type": "string"}
          },
          "protocolMappers": {
            "type": "array",
            "description": "Protocol mappers for this scope",
            "items": {
              "type": "object",
              "properties": {
                "name": {
                  "type": "string",
                  "description": "Mapper name"
                },
                "protocol": {
                  "type": "string",
                  "description": "Protocol (openid-connect or saml)"
                },
                "protocolMapper": {
                  "type": "string",
                  "description": "Mapper type (e.g., oidc-audience-mapper)"
                },
                "config": {
                  "type": "object",
                  "description": "Mapper configuration",
                  "additionalProperties": {"type": "string"}
                }
              },
              "required": ["name", "protocolMapper"]
            }
          }
        },
        "required": ["name"]
      }
    },
    "defaultClientScopes": {
      "type": "array",
      "description": "Client scope names to automatically assign as default to new clients",
      "items": {
        "type": "string"
      }
    },
    "optionalClientScopes": {
      "type": "array",
      "description": "Client scope names available as optional for clients",
      "items": {
        "type": "string"
      }
    },
    "roles": {
      "type": "object",
      "description": "Realm role definitions",
      "properties": {
        "realmRoles": {
          "type": "array",
          "description": "List of realm roles",
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string",
                "description": "Role name"
              },
              "description": {
                "type": "string",
                "description": "Role description"
              },
              "composite": {
                "type": "boolean",
                "description": "Is composite role"
              },
              "compositeRoles": {
                "type": "array",
                "description": "Names of roles to include in this composite role",
                "items": {
                  "type": "string"
                }
              }
            },
            "required": ["name"]
          }
        }
      }
    },
    "groups": {
      "type": "array",
      "description": "Group definitions",
      "items": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "description": "Group name"
          },
          "path": {
            "type": "string",
            "description": "Group path (e.g., /parent/child)"
          },
          "attributes": {
            "type": "object",
            "description": "Group attributes",
            "additionalProperties": {
              "type": "array",
              "items": {"type": "string"}
            }
          },
          "realmRoles": {
            "type": "array",
            "description": "Realm roles assigned to this group",
            "items": {"type": "string"}
          },
          "clientRoles": {
            "type": "object",
            "description": "Client roles assigned to this group (clientId -> role names)",
            "additionalProperties": {
              "type": "array",
              "items": {"type": "string"}
            }
          },
          "subGroups": {
            "type": "array",
            "description": "Subgroups of this group",
            "items": {"type": "object"}
          }
        },
        "required": ["name"]
      }
    },
    "defaultGroups": {
      "type": "array",
      "description": "Group names or paths to automatically assign to new users",
      "items": {
        "type": "string"
      }
    },
    "eventsConfig": {
      "type": "object",
      "description": "Event logging configuration",
      "properties": {
        "eventsEnabled": {
          "type": "boolean",
          "description": "Enable event logging"
        },
        "adminEventsEnabled": {
          "type": "boolean",
          "default": true,
          "description": "Enable admin event logging (required for drift detection)"
        },
        "adminEventsDetailsEnabled": {
          "type": "boolean",
          "default": true,
          "description": "Include details in admin events (recommended for drift detection)"
        },
        "eventsListeners": {
          "type": "array",
          "description": "Event listeners",
          "items": {"type": "string"}
        },
        "enabledEventTypes": {
          "type": "array",
          "description": "Enabled event types",
          "items": {"type": "string"}
        },
        "eventsExpiration": {
          "type": "integer",
          "description": "Event expiration in seconds"
        }
      }
    },
    "userFederation": {
      "type": "array",
      "description": "User federation provider configurations (LDAP, AD, Kerberos)",
      "items": {
        "type": "object",
        "required": ["name", "providerId"],
        "properties": {
          "name": {
            "type": "string",
            "description": "Federation provider display name"
          },
          "providerId": {
            "type": "string",
            "enum": ["ldap", "kerberos"],
            "description": "Provider type"
          },
          "priority": {
            "type": "integer",
            "minimum": 0,
            "default": 0,
            "description": "Provider priority (lower = higher priority)"
          },
          "enabled": {
            "type": "boolean",
            "default": true
          },
          "connectionUrl": {
            "type": "string",
            "description": "LDAP connection URL"
          },
          "bindDn": {
            "type": "string",
            "description": "DN for binding to LDAP"
          },
          "bindCredentialSecret": {
            "type": "object",
            "description": "Secret reference for bind password",
            "properties": {
              "name": {"type": "string"},
              "key": {"type": "string"}
            },
            "required": ["name", "key"]
          },
          "usersDn": {
            "type": "string",
            "description": "Base DN for user searches"
          },
          "vendor": {
            "type": "string",
            "enum": ["ad", "rhds", "tivoli", "edirectory", "other"],
            "default": "other"
          },
          "usernameLdapAttribute": {
            "type": "string",
            "default": "uid"
          },
          "uuidLdapAttribute": {
            "type": "string",
            "default": "entryUUID"
          },
          "rdnLdapAttribute": {
            "type": "string",
            "default": "uid"
          },
          "userObjectClasses": {
            "type": "array",
            "items": {"type": "string"}
          },
          "startTls": {
            "type": "boolean",
            "default": false
          },
          "trustEmail": {
            "type": "boolean",
            "default": false
          },
          "editMode": {
            "type": "string",
            "enum": ["READ_ONLY", "WRITABLE", "UNSYNCED"],
            "default": "READ_ONLY"
          },
          "searchScope": {
            "type": "integer",
            "minimum": 1,
            "maximum": 2,
            "default": 2
          },
          "allowKerberosAuthentication": {
            "type": "boolean",
            "default": false
          },
          "kerberosRealm": {
            "type": "string"
          },
          "serverPrincipal": {
            "type": "string"
          },
          "keytabSecret": {
            "type": "object",
            "properties": {
              "name": {"type": "string"},
              "key": {"type": "string"}
            },
            "required": ["name", "key"]
          },
          "syncSettings": {
            "type": "object",
            "properties": {
              "importEnabled": {"type": "boolean", "default": true},
              "fullSyncPeriod": {"type": "integer", "default": -1},
              "changedUsersSyncPeriod": {"type": "integer", "default": -1}
            }
          },
          "mappers": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["name", "mapperType"],
              "properties": {
                "name": {"type": "string"},
                "mapperType": {"type": "string"},
                "config": {
                  "type": "object",
                  "additionalProperties": {"type": "string"}
                }
              }
            }
          }
        }
      }
    },
    "passwordPolicy": {
      "type": "object",
      "description": "Password policy configuration",
      "properties": {
        "length": {
          "type": "integer",
          "minimum": 1,
          "description": "Minimum password length"
        },
        "upperCase": {
          "type": "integer",
          "minimum": 0,
          "description": "Minimum uppercase characters"
        },
        "lowerCase": {
          "type": "integer",
          "minimum": 0,
          "description": "Minimum lowercase characters"
        },
        "digits": {
          "type": "integer",
          "minimum": 0,
          "description": "Minimum digit characters"
        },
        "specialChars": {
          "type": "integer",
          "minimum": 0,
          "description": "Minimum special characters"
        },
        "notUsername": {
          "type": "boolean",
          "description": "Password cannot equal username"
        },
        "notEmail": {
          "type": "boolean",
          "description": "Password cannot equal email"
        },
        "hashIterations": {
          "type": "integer",
          "minimum": 1,
          "description": "PBKDF2 hash iterations"
        },
        "passwordHistory": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of previous passwords to check"
        },
        "forceExpiredPasswordChange": {
          "type": "integer",
          "minimum": 0,
          "description": "Days until password expires and must be changed (0 = immediate expiration)"
        },
        "maxLength": {
          "type": "integer",
          "minimum": 1,
          "description": "Maximum password length"
        },
        "regexPattern": {
          "type": "string",
          "description": "Custom regex pattern for password validation"
        }
      }
    },
    "extraManifests": {
      "type": "array",
      "description": "Extra Kubernetes manifests to deploy (e.g., ExternalSecrets, SealedSecrets, ConfigMaps)",
      "items": {
        "type": "object",
        "description": "A Kubernetes manifest in YAML format"
      }
    },
    "commonLabels": {
      "type": "object",
      "additionalProperties": {"type": "string"}
    },
    "commonAnnotations": {
      "type": "object",
      "additionalProperties": {"type": "string"}
    },
    "rbac": {
      "type": "object",
      "description": "RBAC configuration for operator access to this namespace",
      "properties": {
        "create": {
          "type": "boolean",
          "description": "Create RoleBinding for operator access to secrets in this namespace",
          "default": true
        },
        "operatorClusterRoleName": {
          "type": "string",
          "description": "Name of the operator's ClusterRole for namespace access",
          "default": "keycloak-operator-namespace-access"
        },
        "operatorServiceAccountName": {
          "type": "string",
          "description": "Override for operator's ServiceAccount name"
        }
      }
    }
  }
}
