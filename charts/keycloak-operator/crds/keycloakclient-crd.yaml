apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: keycloakclients.vriesdemichael.github.io
  labels:
    app.kubernetes.io/name: keycloak-operator
    app.kubernetes.io/component: crd
spec:
  group: vriesdemichael.github.io
  versions:
  - name: v1
    served: true
    storage: true
    schema:
      openAPIV3Schema:
        type: object
        description: Keycloak client configuration for dynamic OAuth2/OIDC client provisioning
        properties:
          apiVersion:
            type: string
          kind:
            type: string
          metadata:
            type: object
          spec:
            type: object
            description: Specification for a Keycloak client
            x-kubernetes-validations:
              - rule: "!has(self.clientSecret) || !has(self.secretRotation) || !self.secretRotation.enabled"
                message: "Manual client secret (clientSecret) cannot be used with automated secret rotation (secretRotation.enabled=true)."
            properties:
              clientId:
                type: string
                description: Unique client identifier
                minLength: 1
                maxLength: 255
              clientName:
                type: string
                description: Human-readable client name
              description:
                type: string
                description: Client description
              realmRef:
                type: object
                description: Reference to the parent KeycloakRealm
                properties:
                  name:
                    type: string
                    description: Name of the KeycloakRealm CR
                  namespace:
                    type: string
                    description: Namespace of the KeycloakRealm CR
                required:
                - name
                - namespace
              publicClient:
                type: boolean
                description: Whether this is a public client
                default: false
              bearerOnly:
                type: boolean
                description: Bearer-only client
                default: false
              protocol:
                type: string
                description: Client protocol
                enum:
                - openid-connect
                - saml
                - docker-v2
                default: openid-connect
              redirectUris:
                type: array
                description: Valid redirect URIs
                items:
                  type: string
                  format: uri
              webOrigins:
                type: array
                description: Valid web origins for CORS
                items:
                  type: string
              postLogoutRedirectUris:
                type: array
                description: Valid post-logout redirect URIs
                items:
                  type: string
                  format: uri
              settings:
                type: object
                description: Advanced client settings
                properties:
                  alwaysDisplayInConsole:
                    type: boolean
                    default: false
                  clientAuthenticatorType:
                    type: string
                    enum:
                    - client-secret
                    - client-jwt
                    - client-secret-jwt
                    - client-x509
                    default: client-secret
                  standardFlowEnabled:
                    type: boolean
                    description: Enable standard flow (authorization code flow)
                    default: true
                  implicitFlowEnabled:
                    type: boolean
                    description: Enable implicit flow
                    default: false
                  directAccessGrantsEnabled:
                    type: boolean
                    description: Enable direct access grants (password flow)
                    default: true
                  serviceAccountsEnabled:
                    type: boolean
                    description: Enable service accounts
                    default: false
                  consentRequired:
                    type: boolean
                    default: false
                  displayOnConsentScreen:
                    type: boolean
                    default: true
                  includeInTokenScope:
                    type: boolean
                    default: true
                  frontchannelLogout:
                    type: boolean
                    description: Enable front-channel logout
                    default: true
                  fullScopeAllowed:
                    type: boolean
                    description: Allow full scope for role mappings
                    default: true
                  authorizationServicesEnabled:
                    type: boolean
                    description: Enable fine-grained authorization support
                    default: false
                  accessTokenLifespan:
                    type: integer
                    description: Access token lifespan in seconds
                    minimum: 1
                  refreshTokenLifespan:
                    type: integer
                    description: Refresh token lifespan in seconds
                    minimum: 1
                  clientSessionIdleTimeout:
                    type: integer
                    description: Client session idle timeout in seconds
                    minimum: 1
                  clientSessionMaxLifespan:
                    type: integer
                    description: Client session max lifespan in seconds
                    minimum: 1
                  pkceCodeChallengeMethod:
                    type: string
                    description: PKCE code challenge method
                    enum:
                    - S256
                    - plain
                    - ""
              authenticationFlows:
                type: object
                description: Client authentication flow overrides
                properties:
                  browserFlow:
                    type: string
                    description: Browser authentication flow
                  directGrantFlow:
                    type: string
                    description: Direct grant authentication flow
                  clientAuthenticationFlow:
                    type: string
                    description: Client authentication flow
              defaultClientScopes:
                type: array
                description: Default client scopes
                items:
                  type: string
              optionalClientScopes:
                type: array
                description: Optional client scopes
                items:
                  type: string
              protocolMappers:
                type: array
                description: Protocol mappers
                items:
                  type: object
                  properties:
                    name:
                      type: string
                    protocol:
                      type: string
                      default: openid-connect
                    protocolMapper:
                      type: string
                    config:
                      type: object
                      additionalProperties:
                        type: string
                  required:
                  - name
                  - protocolMapper
              clientRoles:
                type: array
                description: Client-specific roles to create
                items:
                  type: string
              authorizationSettings:
                type: object
                description: Fine-grained authorization settings (requires authorizationServicesEnabled in settings)
                properties:
                  policyEnforcementMode:
                    type: string
                    description: Policy enforcement mode
                    enum:
                    - ENFORCING
                    - PERMISSIVE
                    - DISABLED
                    default: ENFORCING
                  decisionStrategy:
                    type: string
                    description: Decision strategy for policy evaluation
                    enum:
                    - UNANIMOUS
                    - AFFIRMATIVE
                    - CONSENSUS
                    default: UNANIMOUS
                  allowRemoteResourceManagement:
                    type: boolean
                    description: Allow remote resource management via Protection API
                    default: true
                  scopes:
                    type: array
                    description: Authorization scopes (actions like read, write, delete)
                    items:
                      type: object
                      required:
                      - name
                      properties:
                        name:
                          type: string
                          description: Scope name (e.g., 'read', 'write')
                        displayName:
                          type: string
                          description: Human-readable display name
                        iconUri:
                          type: string
                          description: Icon URI for UI display
                  resources:
                    type: array
                    description: Protected resources (APIs, documents, etc.)
                    items:
                      type: object
                      required:
                      - name
                      properties:
                        name:
                          type: string
                          description: Resource name (unique identifier)
                        displayName:
                          type: string
                          description: Human-readable display name
                        type:
                          type: string
                          description: Resource type for grouping (e.g., 'urn:my-api:resources:documents')
                        uris:
                          type: array
                          description: URIs associated with this resource
                          items:
                            type: string
                        scopes:
                          type: array
                          description: Scope names that apply to this resource
                          items:
                            type: string
                        ownerManagedAccess:
                          type: boolean
                          description: Enable owner-managed access for this resource
                          default: false
                        attributes:
                          type: object
                          description: Resource attributes
                          additionalProperties:
                            type: array
                            items:
                              type: string
                  policies:
                    type: object
                    description: Authorization policies (WHO can access resources)
                    properties:
                      allowJavaScriptPolicies:
                        type: boolean
                        description: "SECURITY: Enable JavaScript policies. Disabled by default."
                        default: false
                      rolePolicies:
                        type: array
                        description: Role-based policies
                        items:
                          type: object
                          required:
                          - name
                          properties:
                            name:
                              type: string
                              description: Policy name (unique identifier)
                            description:
                              type: string
                              description: Policy description
                            logic:
                              type: string
                              description: Policy logic
                              enum:
                              - POSITIVE
                              - NEGATIVE
                              default: POSITIVE
                            roles:
                              type: array
                              description: Roles that grant access
                              items:
                                type: object
                                required:
                                - name
                                properties:
                                  name:
                                    type: string
                                    description: Role name
                                  required:
                                    type: boolean
                                    description: Whether this role is required
                                    default: false
                            fetchRoles:
                              type: boolean
                              description: Fetch roles from userinfo endpoint
                              default: true
                      userPolicies:
                        type: array
                        description: User-based policies
                        items:
                          type: object
                          required:
                          - name
                          properties:
                            name:
                              type: string
                              description: Policy name
                            description:
                              type: string
                            logic:
                              type: string
                              enum:
                              - POSITIVE
                              - NEGATIVE
                              default: POSITIVE
                            users:
                              type: array
                              description: Usernames granted access
                              items:
                                type: string
                      groupPolicies:
                        type: array
                        description: Group-based policies
                        items:
                          type: object
                          required:
                          - name
                          properties:
                            name:
                              type: string
                              description: Policy name
                            description:
                              type: string
                            logic:
                              type: string
                              enum:
                              - POSITIVE
                              - NEGATIVE
                              default: POSITIVE
                            groups:
                              type: array
                              description: Group paths (e.g., '/admin', '/org/team')
                              items:
                                type: string
                            groupsClaim:
                              type: string
                              description: Claim containing group info
                              default: groups
                      clientPolicies:
                        type: array
                        description: Client-based policies
                        items:
                          type: object
                          required:
                          - name
                          properties:
                            name:
                              type: string
                              description: Policy name
                            description:
                              type: string
                            logic:
                              type: string
                              enum:
                              - POSITIVE
                              - NEGATIVE
                              default: POSITIVE
                            clients:
                              type: array
                              description: Client IDs granted access
                              items:
                                type: string
                      timePolicies:
                        type: array
                        description: Time-based policies
                        items:
                          type: object
                          required:
                          - name
                          properties:
                            name:
                              type: string
                              description: Policy name
                            description:
                              type: string
                            logic:
                              type: string
                              enum:
                              - POSITIVE
                              - NEGATIVE
                              default: POSITIVE
                            notBefore:
                              type: string
                              description: Not valid before (ISO 8601)
                            notOnOrAfter:
                              type: string
                              description: Not valid on or after (ISO 8601)
                            dayMonth:
                              type: integer
                              description: Start day of month (1-31)
                              minimum: 1
                              maximum: 31
                            dayMonthEnd:
                              type: integer
                              description: End day of month (1-31)
                              minimum: 1
                              maximum: 31
                            month:
                              type: integer
                              description: Start month (1-12)
                              minimum: 1
                              maximum: 12
                            monthEnd:
                              type: integer
                              description: End month (1-12)
                              minimum: 1
                              maximum: 12
                            year:
                              type: integer
                              description: Start year
                            yearEnd:
                              type: integer
                              description: End year
                            hour:
                              type: integer
                              description: Start hour (0-23)
                              minimum: 0
                              maximum: 23
                            hourEnd:
                              type: integer
                              description: End hour (0-23)
                              minimum: 0
                              maximum: 23
                            minute:
                              type: integer
                              description: Start minute (0-59)
                              minimum: 0
                              maximum: 59
                            minuteEnd:
                              type: integer
                              description: End minute (0-59)
                              minimum: 0
                              maximum: 59
                      regexPolicies:
                        type: array
                        description: Regex-based policies
                        items:
                          type: object
                          required:
                          - name
                          - targetClaim
                          - pattern
                          properties:
                            name:
                              type: string
                              description: Policy name
                            description:
                              type: string
                            logic:
                              type: string
                              enum:
                              - POSITIVE
                              - NEGATIVE
                              default: POSITIVE
                            targetClaim:
                              type: string
                              description: Claim to match against
                            pattern:
                              type: string
                              description: Regex pattern
                      aggregatePolicies:
                        type: array
                        description: Aggregate policies (combine other policies)
                        items:
                          type: object
                          required:
                          - name
                          properties:
                            name:
                              type: string
                              description: Policy name
                            description:
                              type: string
                            logic:
                              type: string
                              enum:
                              - POSITIVE
                              - NEGATIVE
                              default: POSITIVE
                            decisionStrategy:
                              type: string
                              description: How to combine results
                              enum:
                              - UNANIMOUS
                              - AFFIRMATIVE
                              - CONSENSUS
                              default: UNANIMOUS
                            policies:
                              type: array
                              description: Names of policies to aggregate
                              items:
                                type: string
                      javascriptPolicies:
                        type: array
                        description: JavaScript policies (requires allowJavaScriptPolicies=true)
                        items:
                          type: object
                          required:
                          - name
                          - code
                          properties:
                            name:
                              type: string
                              description: Policy name
                            description:
                              type: string
                            logic:
                              type: string
                              enum:
                              - POSITIVE
                              - NEGATIVE
                              default: POSITIVE
                            code:
                              type: string
                              description: JavaScript code for the policy
                  permissions:
                    type: object
                    description: Authorization permissions (tie policies to resources/scopes)
                    properties:
                      resourcePermissions:
                        type: array
                        description: Resource-based permissions (grant access to entire resources)
                        items:
                          type: object
                          required:
                          - name
                          properties:
                            name:
                              type: string
                              description: Permission name (unique identifier)
                            description:
                              type: string
                              description: Permission description
                            decisionStrategy:
                              type: string
                              description: How to combine policy results
                              enum:
                              - UNANIMOUS
                              - AFFIRMATIVE
                              - CONSENSUS
                              default: UNANIMOUS
                            resources:
                              type: array
                              description: Resource names this permission applies to
                              items:
                                type: string
                            resourceType:
                              type: string
                              description: Apply to all resources of this type
                            policies:
                              type: array
                              description: Policy names that control access
                              items:
                                type: string
                      scopePermissions:
                        type: array
                        description: Scope-based permissions (grant access to specific scopes)
                        items:
                          type: object
                          required:
                          - name
                          - scopes
                          properties:
                            name:
                              type: string
                              description: Permission name (unique identifier)
                            description:
                              type: string
                              description: Permission description
                            decisionStrategy:
                              type: string
                              description: How to combine policy results
                              enum:
                              - UNANIMOUS
                              - AFFIRMATIVE
                              - CONSENSUS
                              default: UNANIMOUS
                            resources:
                              type: array
                              description: Resource names to scope this permission to (optional)
                              items:
                                type: string
                            resourceType:
                              type: string
                              description: Apply to all resources of this type
                            scopes:
                              type: array
                              description: Scope names this permission applies to
                              minItems: 1
                              items:
                                type: string
                            policies:
                              type: array
                              description: Policy names that control access
                              items:
                                type: string
              serviceAccountRoles:
                type: object
                description: Role mappings for the client's service account user
                properties:
                  realmRoles:
                    type: array
                    description: Realm-level roles to assign to the service account
                    items:
                      type: string
                    example:
                    - offline_access
                    - uma_authorization
                  clientRoles:
                    type: object
                    description: Client-level roles to assign to the service account
                    additionalProperties:
                      type: array
                      items:
                        type: string
                    example:
                      api-server:
                      - read:data
                      - write:data
                      admin-console:
                      - view-users
              attributes:
                type: object
                description: Additional client attributes
                additionalProperties:
                  type: string
              regenerateSecret:
                type: boolean
                description: Regenerate client secret on update
                default: false
              secretName:
                type: string
                description: Name of Kubernetes secret for client credentials
              secretMetadata:
                type: object
                description: Metadata to attach to the managed secret
                properties:
                  labels:
                    type: object
                    description: Labels to add to the secret
                    additionalProperties:
                      type: string
                  annotations:
                    type: object
                    description: Annotations to add to the secret
                    additionalProperties:
                      type: string
              clientSecret:
                type: object
                description: Reference to an existing secret containing the client secret. If set, this secret is used instead of generating one. Cannot be used with secret rotation.
                properties:
                  name:
                    type: string
                    description: Secret name
                  key:
                    type: string
                    description: Key in secret data containing the client secret
                required:
                - name
                - key
              secretRotation:
                type: object
                description: Automated secret rotation configuration
                properties:
                  enabled:
                    type: boolean
                    description: Enable automated secret rotation
                    default: false
                  rotationPeriod:
                    type: string
                    description: Rotation period (e.g., '90d', '24h', '10s')
                    default: "90d"
                  rotationTime:
                    type: string
                    description: Target time for rotation in 'HH:MM' format
                  timezone:
                    type: string
                    description: IANA Timezone for rotation scheduling
                    default: "UTC"
              manageSecret:
                type: boolean
                description: Create and manage Kubernetes secret for credentials
                default: true
            required:
            - clientId
            - realmRef
          status:
            type: object
            description: Current status of the Keycloak client
            properties:
              phase:
                type: string
                description: Current phase
                enum:
                - Pending
                - Provisioning
                - Ready
                - Failed
                - Updating
                - Degraded
              message:
                type: string
              reason:
                type: string
              conditions:
                type: array
                items:
                  type: object
                  properties:
                    type:
                      type: string
                    status:
                      type: string
                      enum:
                      - 'True'
                      - 'False'
                      - Unknown
                    reason:
                      type: string
                    message:
                      type: string
                    lastTransitionTime:
                      type: string
                      format: date-time
                  required:
                  - type
                  - status
              observedGeneration:
                type: integer
              clientId:
                type: string
              internalId:
                type: string
              realm:
                type: string
              publicClient:
                type: boolean
              keycloakInstance:
                type: string
              credentialsSecret:
                type: string
              endpoints:
                type: object
                properties:
                  auth:
                    type: string
                  token:
                    type: string
                  userinfo:
                    type: string
                  jwks:
                    type: string
                  issuer:
                    type: string
                  endSession:
                    type: string
              lastHealthCheck:
                type: string
                format: date-time
              lastUpdated:
                type: string
                format: date-time
              createdRoles:
                type: array
                items:
                  type: string
              appliedMappers:
                type: array
                items:
                  type: string
              authorizationGranted:
                type: boolean
                description: Whether this client's namespace is authorized by the realm
                default: false
              authorizationMessage:
                type: string
                description: Human-readable authorization status message
    additionalPrinterColumns:
    - name: Phase
      type: string
      jsonPath: .status.phase
    - name: Client ID
      type: string
      jsonPath: .spec.clientId
    - name: Realm
      type: string
      jsonPath: .spec.realm
    - name: Keycloak
      type: string
      jsonPath: .status.keycloakInstance
    - name: Public
      type: boolean
      jsonPath: .status.publicClient
    - name: Age
      type: date
      jsonPath: .metadata.creationTimestamp
  scope: Namespaced
  names:
    plural: keycloakclients
    singular: keycloakclient
    kind: KeycloakClient
    shortNames:
    - kcc
